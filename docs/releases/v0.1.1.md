# Gonimbus v0.1.1 Release Notes

**Release Date**: 2026-01-05
**Status**: Enterprise Auth & Test Infrastructure

## Overview

Gonimbus v0.1.1 focuses on enterprise authentication UX and test infrastructure. This release adds AWS SSO/profile support with improved diagnostics, and establishes cloud integration testing that raises S3 provider coverage from 49% to 97%.

## Features

### AWS Profile & SSO Authentication

Enterprise users can now use the `--profile` flag with `doctor` to validate SSO credentials:

```bash
# Validate SSO profile
gonimbus doctor --provider s3 --profile my-sso-profile
```

Output includes:

- Credential source identification (e.g., `SSOProvider`)
- Access key preview (last 4 characters)
- Expiration time with warning if < 1 hour remaining

#### Multi-Account SSO

AWS SSO uses a shared session model. One `aws sso login` authenticates all profiles sharing the same SSO session:

```bash
# Single login covers multiple accounts
aws sso login --profile myorg-account-a

# Both work concurrently
gonimbus inspect s3://bucket-in-account-a/ --profile myorg-account-a &
gonimbus inspect s3://bucket-in-account-b/ --profile myorg-account-b &
```

See [docs/auth/aws-profiles.md](../auth/aws-profiles.md) for configuration patterns.

#### IMDS Timeout Optimization

When profile or environment credentials are available, the doctor command now disables IMDS probing. This eliminates the 4-second timeout on non-EC2 environments.

### Cloud Integration Tests

New test infrastructure using moto (AWS mock server) enables real SDK testing without AWS credentials.

#### What's Tested

| Component   | Tests                                              |
| ----------- | -------------------------------------------------- |
| S3 Provider | `New`, `List`, `Head`, `Close`, pagination, errors |
| CLI Inspect | JSON output, prefix filtering, `--limit` flag      |

#### Coverage Impact

| Package           | Before | After   |
| ----------------- | ------ | ------- |
| `pkg/provider/s3` | 49%    | **97%** |

#### Running Cloud Tests

```bash
# Local development
make moto-start    # Start moto on port 5555
make test-cloud    # Run cloud integration tests
make moto-stop     # Stop moto

# CI runs automatically with moto service container
```

#### Test Philosophy

CLI integration tests use `exec.Command` to run the actual binary. This tests real CLI behavior (argument parsing, exit codes, JSON output) but doesn't contribute to `go test` coverage metrics. We accept this trade-off because:

1. Core logic is covered by unit tests in respective packages
2. CLI tests catch integration issues that unit tests miss
3. Direct cobra command testing would duplicate coverage without adding value

See [docs/development/testing.md](../development/testing.md) for full testing strategy.

## Changes

### Added

- `doctor --profile` flag for AWS profile/SSO diagnostics
- Credential expiry check with < 1 hour warning
- IMDS timeout disabled when profile/env credentials available
- SSO-aware help text (`aws sso login` guidance)
- Cloud integration tests with moto
- Test helpers: `test/cloudtest/` package
- Makefile targets: `test-cloud`, `moto-start`, `moto-stop`, `moto-status`
- CI `cloud-integration` job with moto service container
- Documentation: `docs/auth/aws-profiles.md`, `docs/development/testing.md`

### Fixed

- `make install` now installs to `~/.local/bin` correctly

### Changed

- `ec2/imds` promoted from indirect to direct dependency

## Test Coverage

| Package           | Coverage | Notes                           |
| ----------------- | -------- | ------------------------------- |
| `pkg/provider/s3` | 97%      | +48% from cloud tests           |
| `pkg/match`       | 98%      | Unchanged                       |
| `pkg/output`      | 92%      | Unchanged                       |
| `pkg/crawler`     | 86%      | Unchanged                       |
| `pkg/manifest`    | 82%      | Unchanged                       |
| `internal/cmd`    | 46%      | CLI binary tests don't register |

## Known Limitations

- **SSO Token Refresh**: Gonimbus doesn't refresh expired SSO tokens; run `aws sso login` externally
- **CLI Coverage Metrics**: `exec.Command` tests don't contribute to `go tool cover` (intentional)
- **Moto Limitations**: Some advanced S3 features may behave differently than real AWS

## Upgrade Notes

No breaking changes from v0.1.0. Upgrade with:

```bash
go install github.com/3leaps/gonimbus/cmd/gonimbus@v0.1.1
```

## Contributors

- Dave Thompson (@3leapsdave)

## Dependencies

No new runtime dependencies. Test dependencies:

- `motoserver/moto:latest` (Docker, for cloud integration tests only)

## License

Apache License 2.0 - see [LICENSE](../../LICENSE)
